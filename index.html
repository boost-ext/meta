<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benchmark</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/1.1.1/chartjs-plugin-zoom.min.js"></script>
    <style>
        .topbar {
            background-color: #333;
            color: #FFF;
            padding: 10px;
            text-align: center;
            text-align: left;
        }
        .topbar a {
            color: #FFF;
            text-decoration: none;
            margin: 0 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="topbar">
        <select onchange="select()">
          <option value="clang-p2996">clang-p2996 -stdlib=libc++ -std=c++2c -freflection</option>
          <option value="clang-17">clang++-17 -std=c++20</option>
          <option value="gcc-13">g++-13 -std=c++20</option>
        </select>
        |
        <a id="at" class="none" href="#" onclick="loadCSV('at.csv', this)">at</a>
        <a id="drop" class="none" href="#" onclick="loadCSV('drop.csv', this)">drop</a>
        <a id="erase" class="none" href="#" onclick="loadCSV('erase.csv', this)">erase</a>
        <a id="filter" class="none" href="#" onclick="loadCSV('filter.csv', this)">filter</a>
        <a id="insert" class="none" href="#" onclick="loadCSV('insert.csv', this)">insert</a>
        <a id="reverse" class="none" href="#" onclick="loadCSV('reverse.csv', this)">reverse</a>
        <a id="take" class="none" href="#" onclick="loadCSV('take.csv', this)">take</a>
        <a id="unique" class="none" href="#" onclick="loadCSV('unique.csv', this)">unique</a>
        |
        <a href="https://github.com/boost-ext/mp/tree/benchmark">github</a>
        |
    </div>
    <canvas id="chart" style="margin: 25px;"></canvas>
    <script>
        let chart;
        let test;
        let compiler;

        function select() {
          compiler = document.querySelector("select").value;
        }

        function loadCSV(filename, element) {
            elements = document.getElementsByClassName('none');
            for (var i = 0; i < elements.length; ++i) {
              elements[i].style.color='gray';
            }
            if (element.style.color == "white") {
              element.style.color='gray';
            } else {
              element.style.color='white';
              test = element.id;
            }

            fetch("results/" + compiler + "/" + filename)
                .then(response => response.text())
                .then(data => {
                    const rows = data.trim().split('\n');
                    const headers = rows[0].split(',');
                    const datasets = [];

                    for (let i = 1; i < headers.length; i++) {
                        datasets.push({
                            label: headers[i],
                            data: [],
                            borderWidth: 1,
                            fill: false
                        });
                    }

                    rows.slice(1).forEach(row => {
                        const values = row.split(',');
                        for (let i = 1; i < values.length; i++) {
                            datasets[i - 1].data.push(values[i]);
                        }
                    });

                    const ctx = document.getElementById('chart').getContext('2d');
                    if (chart) { chart.destroy(); }
                    chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: rows.slice(1).map(row => row.split(',')[0]),
                            datasets: datasets
                        },

                          options: {
                              plugins: {
                                  zoom: {
                                      zoom: {
                                          wheel: { enabled: true, },
                                          pinch: { enabled: true, },
                                          mode: 'xy',
                                      },
                                  },
                                  pan: {
                                      enabled: true,
                                      mode: 'xy',
                                  },
                                  legend: {
                                      display: true,
                                      position: 'top',
                                      align: 'end',
                                  }
                              },
                              scales: {
                                  x: {
                                      title: {
                                          display: true,
                                          text: 'Number of elements'
                                      },
                                  },
                                  y: {
                                      title: {
                                          display: true,
                                          text: 'Compilation time [seconds]',
                                      },
                                  }
                              }
                          }
                    });
                })
        }

        select();
        loadCSV('at.csv', document.getElementsByClassName('none')[0]);
    </script>
</body>
</html>
